= README

image:https://www.updatecli.io/images/updatecli.png[alt=Updatecli,float="right",align="center",width=200,height=200]

link:https://matrix.to/#/#Updatecli_community:gitter.im[image:https://img.shields.io/matrix/updatecli:matrix.org[]]
link:https://github.com/updatecli/policies/blob/main/LICENSE[image:https://img.shields.io/github/license/updatecli/policies[GitHub]]
link:https://img.shields.io/github/actions/workflow/status/updatecli/policies/validate.yaml?branch=main[image:https://img.shields.io/github/actions/workflow/status/updatecli/policies/validate.yaml?branch=main[GitHub Workflow Status]]

These policies are a collection of official Updatecli bundles that automate common update tasks (Golang, npm, Docker, ...).
Policies are published to the GitHub Container Registry under `ghcr.io/updatecli/policies` and follow semantic versioning.

== Policies

A list of all available policies: link:./POLICIES.md[Full policy list]

== Quick start

Inspect a published policy manifest:

[source,shell]
----
updatecli manifest show ghcr.io/updatecli/policies/autodiscovery/golang:latest
----

Dry-run (show what would change):

[source,shell]
----
updatecli diff ghcr.io/updatecli/policies/autodiscovery/golang:latest
----

Apply a policy:

[source,shell]
----
updatecli apply --config ghcr.io/updatecli/policies/autodiscovery/golang:latest
----

Compose multiple policies from a local compose file:

* Create `updatecli-compose.yaml` (example below).
* Run:

[source,shell]
----
updatecli compose apply --config ./updatecli-compose.yaml
----

.updatecli-compose.yaml
----
policies:
  - policy: "ghcr.io/updatecli/policies/autodiscovery/golang:latest"
  - policy: "ghcr.io/updatecli/policies/autodiscovery/npm:latest"
----

Note: values passed at runtime override bundle defaults. See each policy README for available values.

== Authentication / registry

Policies are published on `ghcr.io`. Public pulls usually work, but authenticating reduces rate limiting and enables access to private bundles:

[source,shell]
----
docker login ghcr.io
----

For private bundles provide credentials via your container runtime or Updatecli's registry auth options.

== How to inspect & test locally

To inspect a policy bundle shipped inside a folder (useful for development):

[source,shell]
----
updatecli manifest show --config ./policy-folder/updatecli.d --values ./policy-folder/values.yaml
----

Render graph (Mermaid):

[source,shell]
----
updatecli manifest show --config ./policy-folder/updatecli.d --values ./policy-folder/values.yaml --graph --graph-flavor mermaid
----

== Publishing

Policies in this repository are published automatically by CI when `Policy.yaml` version is bumped. When changing a policy:

* Update `Policy.yaml.version` following semver.
* Update `CHANGELOG.md` and the policy `README.md`.
* Ensure CI validation (lint/manifest tests) passes.

== CONTRIBUTING

If you want to contribute, see link:./CONTRIBUTING.adoc[CONTRIBUTING] for contribution guidelines, PR checklist and publishing details.

Short contributor checklist:

* Open an issue to discuss non-trivial changes.
* Bump Policy.yaml version if behaviour changes.
* Update README, CHANGELOG and example values.
* Ensure CI passes before merging.

== FAQ

=== Why a monorepo?
A monorepo simplifies discovery, CI and publishing for policy bundles. We may split into multiple repos later as needed.

== Thanks to all the contributors ❤️

link:https://github.com/updatecli/policies/graphs/contributors[image:https://contrib.rocks/image?repo=updatecli/policies[]]

== Links

* link:https://www.updatecli.io/docs/core/compose/[Updatecli Compose documentation]
* link:./POLICIES.md[Full Policy list]
